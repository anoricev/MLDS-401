---
title: "Homework 3"
output: pdf_document
date: "2025-10-06"
author: "Arielle Weinstein, Jack Bailey, Junbo (Jacob) Lian, Veronica Lin, Jiashu Huang"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1

```{r}
auto <- read.table("~/Desktop/401/hw3/auto.txt", head=T)
```

## (a). The origin variable is categorical, where 1=US, 2=Europe and 3=Japan. Submit a table of the variable (i.e., frequency distribution).

```{r}
auto$origin = factor(auto$origin, 1:3, c("US", "Europe", "Japan"))
table(auto$origin)
```

## (b). Regress mpg on origin, weight and year. Examine the diagnostic plots and comment on which assumptions of the linear model, if any, are violated.

```{r}
fit1 <- lm(mpg ~ origin + weight + year, data=auto)
summary(fit1)
```

```{r}
plot(fit1, which=1)
```

```{r}
plot(fit1, which=2)
```

```{r}
plot(fit1, which=3)
```

```{r}
plot(fit1, which=5)
```
The assumptions of the linear model that are violated are that the residuals plot shows a pattern to the data, deviating from the "snowstorm" that we expect. The residuals follow a slight U pattern. The Q-Q plot also shows the data deviating from the line towards the ends which is not indicative of a good fit. 

## (c). Regress log(mpg) on origin, log(weight), year and year squared. Examine the diagnostic plots and the summary. Comment on whether the model assumptions are roughly satisfied

```{r}
fit2 <- lm(log(mpg) ~ origin + log(weight) + year + I(year^2), data=auto)
summary(fit2)
```

```{r}
plot(fit2, which=1)
```

```{r}
plot(fit2, which=2)
```

```{r}
plot(fit2, which=3)
```

```{r}
plot(fit2, which=5)
```
The residuals plot for this fit is much more indicative of a better fit because it demonstrates a "snowstorm" and there is no pattern to the residuals. The Q-Q plot still shows some deviation from the line but it roughly satisfies this condition. 

## d) Use the results from the previous part to describe the effect of year on log(mpg), i.e., is it U-shaped, inverted-U shaped, or linear? If it is nonlinear, where is the minimum or maximum. Submit a graph showing the effect. For you to think about but not turn in: why would year have this effect?

```{r}
b1 = coef(fit2)["year"]
b2 = coef(fit2)["I(year^2)"]

-b1 / (2 * b2)
```

Since b2>0, it is U-shaped as the parabola opens upward. By taking the derivative and setting it to 0, we find the minimum at around year = 1967.

```{r}
library(ggplot2)
ggplot(auto, aes(x = year, y = log(mpg))) + 
  geom_smooth(method = "lm", formula = y ~ x + I(x^2)) + 
  labs(title = "The effect of year on log(mpg)")
```

## (e) What does the coefficient for log(weight) tell you? How is unlogged mpg related to unlogged weight?

```{r}
summary(fit2)
```

```{r}
ggplot(auto, aes(x = weight, y = mpg)) + 
  geom_smooth(method = "lm", formula = y ~ x) + 
  labs(title = "The effect of weight on mpg")
```
The coefficient tells us that on average as the log of the weight increases, the log of miles per gallon decreases. This is also the case for the unlogged mpg and unlogged weight. As the weight increases, on average the miles per gallon will decrease.

# Question 5

## (b). You will now check your work with the auto data set. Regress mpg on year and year squared. Note the coefficients

```{r}
fit3 <- lm(mpg ~ year + I(year^2), data = auto)
summary(fit3)
```

## (c). What is the correlation between year and year squared?

```{r}
cor(auto$year, auto$year^2)
```

## (d). What is the mean of year?

```{r}
mean(auto$year)
```

## (e). What is the correlation between year and year squared after mean centering?

```{r}
year_c  <- auto$year - mean(auto$year)
cor(year_c, I(year_c^2))
```

## (f). To understand why the correlation is reduced, plot year squared against year, and separately centered year squared versus centered year.

```{r}
plot(auto$year, auto$year^2,
     xlab = "year", ylab = "year squared",
     main = paste0("corr = ", round(cor(auto$year, auto$year^2), 3)))
```

```{r}
plot(year_c, year_c^2,
     xlab = "centered year", ylab = "centered year squared",
     main = paste0("corr = ", round(cor(year_c, year_c^2), 3)))
```

## (g). Regress mpg on centered year and centered year squared. Note the coefficients

```{r}
fit4 <- lm(mpg ~ year_c + I(year_c^2), data=auto)
summary(fit4)
```

## (h). Substitute your estimates from the previous part into the expressions you derived in part (a) and show that the equal the estimates from part (b)

```{r}
x_bar <- mean(auto$year)
gamma0 <- coef(fit4)[1]
gamma1 <- coef(fit4)[2]
gamma2 <- coef(fit4)[3]

beta0 <- gamma0 - gamma1 * x_bar + gamma2 * x_bar^2
beta1 <- gamma1 - 2 * gamma2 * x_bar
beta2 <- gamma2

rbind("estimates from part (b)" = coef(fit3),
      "expressions in (a)" = c(beta0, beta1, beta2))
```

# Question 6

## (a). Estimate Model 1 and report the output: \[\log(y + 1) = \beta_0 + \beta_1 \log(x + 1)\]
```{r}
part <- read_csv("part.csv")
fit6 <- lm(log(part$y + 1) ~ log(part$x + 1) + part$tx)
summary(fit6)
```
## (b). Estimate Model 2: \[ \log(y + 1) = \beta_0 + \beta_1 \log(x + 1) + \beta_2 \, tx + e\]
```{r}
fit7 <- lm(log(part$y + 1) ~ log(part$x + 1) + part$tx + log(part$wc + 1))
summary(fit7)
```

## (c). Based on Model 1, does participation have a significant effect on future spending? Test the appropriate hypothesis at the 5% level and interpret the estimate of \(\beta_2\).
```{r}
exp(.24438)-1
```

## (d). Using Model 1, post-period spending is how many times greater for those who participate than for those who do not? Note that this question asks about spending and not log spending. Another way to ask this question is: suppose there are two people with identical pre-period spending, but one participates and the other does not. More precisely, if \(y_1\) is the post-contest spending of a participant and \(y_0\) is the post-contest spending of a non-participant, how many times greater is \((y_1 + 1)\) than \((y_0 + 1)\)?


## (e). Why is the magnitude of the tx variable so different in Model 2 (0.050) than in Model 1 (0.244)?
In model 2, we add on the Î²3 log(wc + 1) term. In this data set, wc is the number of words that each participant wrote. The relationship between wc and tx is that if wc is greater than 0, tx is 1, whereas when wc is 0, tx is 0. So, if one of wc or tx is 0 for a given observation, then they both will be 0. However, wc can be much greater than tx. If a participant writes a long entry, then wc will be large, whereas tx will still be 1. Therefore, in the model, the wc term will be more significant than the tx value because wc has a much higher maximum than tx, but has the same minimum and will be this minimum value at the same time. So, including the wc variable in the model makes the tx value much less significant in the future predicted spending. 

## (f). Now consider Model 2. How do the results from Model 2 change your conclusions about how participation affects future spending. I am looking for you to summarize the key learnings from Model 2 succinctly.
In model 2, we see the p-value for tx is 0.510. This is a very high value, and if we set up the same hypothesis test from part (d), we would fail to reject the null hypothesis, meaning that we fail to conclude that participation has significant effect on future spending. However, for the log(wc + 1) term, we see a p-value of 0.00637. This value is less than 0.5, meaning in a hypothesis test we would reject the null hypothesis, and conclude that wc has a significant effect on future spending. Therefore a high word count would suggest a higher future spending on average. 

## (g). Why do you think that the word count might affect future spending?
If a participant took the extra time to write a long response for the social media contest, that demonstrates that they care more about the company. If they had a lot to write, that suggests that they are familiar with the company, and if they are already familiar with the company, it also suggests that they are more likely that they are already repeat shoppers and are more likely to come back to shop again. If a participant just wrote a single word, for example, it might demonstrate that they do not care about the company but were rather only participating in order to get the reward. These people are less likely to spend money at the company in the future. 

## (h). What do the results of this analysis suggest the company should do in the future when designing social media contests?
They should only reward those who write a longer response. This could prevent them from paying people who are only there to collect the reward, and instead reward those who are more likely to have shopped there already and shop there again. 
