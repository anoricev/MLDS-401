---
title: "Homework 6"
output: pdf_document
date: "2025-10-28"
author: "Arielle Weinstein, Jack Bailey, Junbo (Jacob) Lian, Veronica Lin, Jiashu Huang"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load data

```{r, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(psych)
library(car)

bike <- read_csv("~/Desktop/401/hw/hw5/bike.csv")
colnames(bike)
```

# Correlation between crimes and trip counts

```{r}
crime_start <- match("ARSON", names(bike))
crime_end <- match("WEAPONS_VIOLATION", names(bike))
crime_cols <- names(bike)[crime_start:crime_end] 
crime_cor <- sapply(crime_cols, function(col) {
  cor(bike[[col]], bike$trips)
})

round(sort(crime_cor), 3)
```

The correlation analysis shows that some crime variables are negatively correlated with Divvy trip counts. Crimes like homicide, weapons violation, and arson show negative correlations, suggesting that serious or violent offenses may discourage biking activity due to safety concerns. Conversely, crimes such as theft, liquor law violation, and prostitution display strong positive correlations, most possibly because they are concentrated in busy downtown areas where Divvy usage is naturally higher. That is, their apparent positive relationship with bike demand does not reflect that these crimes encourage riding, but rather that both occur in densely populated, commercially active neighborhoods.

# Composite variables

```{r}
cbd_components <- c(
  "CTA_BUS_STATIONS", 
  "CTA_TRAIN_STATIONS", 
  "BIKE_ROUTES", 
  "CAPACITY",
  "Limited_Business_License", 
  "Retail_Food_Establishment"
)

criminal_components <- c(
  "ARSON",
  "WEAPONS_VIOLATION",
  "HOMICIDE",
  "MOTOR_VEHICLE_THEFT",
  "OFFENSE_INVOLVING_CHILDREN",
  "GAMBLING",
  "NARCOTICS",
  "HUMAN_TRAFFICKING",
  "BURGLARY",
  "ASSAULT",
  "BATTERY"
)

normalized_index <- function(df, cols) {
  keep <- intersect(cols, names(df))
  m <- scale(df[keep]) 
  as.numeric(rowMeans(m))
}

bike$cbd_index <- normalized_index(bike, cbd_components)
bike$criminal_index <- normalized_index(bike, criminal_components)
```

**Central Business District Index**

The cbd_index measures how strongly each station area resembles a central business district. The variables chosen for the CBD grouping were bus stations, train stations, retail food locations, business licenses, bike routes, and capacity. We expect that due to the nature of these variables there will be a positive relationship between CBD overall and trips on average.

**Criminal Index**

The violent_index summarizes crimes that are most likely to deter Divvy ridership through safety or environmental concerns. For the crime variables, assault, battery, burglary, arson, homicide, intimidation, kidnapping, narcotics, robbery, criminal damage, theft, and interference with public offers were chosen. Initially, we tried to group the crimes by type of crime - i.e. personal harm vs. property damage, but the resulting model found that personal harm crimes were insignificant, which we did not deem to be realistic. We then tried grouping by crime perception - i.e. crimes that make the news like homicide and assault versus those that donâ€™t such as intimidation. This also did not yield significant results, so we decided to group the crimes together and choose the specific crimes we thought would be a factor in affecting trips. 

**Normalization**

To simplify the model and capture broader urban patterns, the crime and CBD variables were combined into composite indices. This helps summarize conceptually similar predictors that likely influence Divvy demand in the same direction. Before averaging, all variables were standardized using z-scored so that differences in scale would not distort the combined index. The index value is then the average of its standardized component scores.


# Correlation matrix & scatterplot

```{r}
vars <- c('trips', 'PARK_AREA_ACRES', 'PER_CAPITA_INCOME', 'POPULATION_SQ_MILE', 
          'MINORITY', 'EDU', 'cbd_index', 'criminal_index')
pairs.panels(bike[, vars], stars=T, density=T)
```

# Fit, residual plot, and VIFs

```{r}
fit = lm(trips ~ PARK_AREA_ACRES + POPULATION_SQ_MILE + MINORITY + EDU + cbd_index + criminal_index, data=bike)

summary(fit)
```

Since PER_CAPITA_INCOME shows a weak correlation with trip counts, it was excluded from the final model. The result of the model yields relationships between the predictor variables and trips. Park area, minority, and crimes have a negative relationship with trips. Population per square mile, education, and CBD have a positive relationship with trips. Of all of the variables, only the coefficient for population per square mile is not significant at the 5% level but at 10% level. The model achieves an R-squared of 0.7, suggesting that approximately 70 percent of the variation in trip counts can be explained by the selected predictors.

An interesting result that was generated from the model is that higher minority decreases the number of trips on average. This could highlight the societal links between race and socioeconomic status implicitly because one would not expect minority to directly affect the number of trips.

```{r}
plot(fit, which=1)
```

The residual plot shows that the residuals are roughly centered around zero with no clear pattern, suggesting that the model's linearity assumption is reasonable. The spread of residuals appears fairly constant across fitted values, showing no major signs of heteroscedasticity.


```{r}
vif(fit)
```

Notice that the VIFs for all predictors are quite low (close to 1), indicating that multicollinearity is not a concern and that the predictors are largely independent of one another.

# Summary
