---
title: "Homework 6"
output: pdf_document
date: "2025-10-28"
author: "Arielle Weinstein, Jack Bailey, Junbo (Jacob) Lian, Veronica Lin, Jiashu Huang"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load data

```{r, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(psych)
library(car)

bike <- read_csv("~/Desktop/401/hw/hw5/bike.csv")
colnames(bike)
```

# Correlation between crimes and trip counts

```{r}
crime_start <- match("ARSON", names(bike))
crime_end <- match("WEAPONS_VIOLATION", names(bike))
crime_cols <- names(bike)[crime_start:crime_end] 
crime_cor <- sapply(crime_cols, function(col) {
  cor(bike[[col]], bike$trips)
})

round(sort(crime_cor), 3)
```

The correlation analysis shows that some crime variables are negatively correlated with Divvy trip counts. Crimes like homicide, weapons violation, and arson show negative correlations, suggesting that serious or violent offenses may discourage biking activity due to safety concerns. Conversely, crimes such as theft, liquor law violation, and prostitution display strong positive correlations, most possibly because they are concentrated in busy downtown areas where Divvy usage is naturally higher. That is, their apparent positive relationship with bike demand does not reflect that these crimes encourage riding, but rather that both occur in densely populated, commercially active neighborhoods.

# Composite variables

```{r}
cbd_components <- c(
  "CTA_BUS_STATIONS", 
  "CTA_TRAIN_STATIONS", 
  "BIKE_ROUTES", 
  "CAPACITY",
  "Limited_Business_License", 
  "Retail_Food_Establishment"
)

criminal_components <- c(
  "ARSON",
  "WEAPONS_VIOLATION",
  "HOMICIDE",
  "MOTOR_VEHICLE_THEFT",
  "OFFENSE_INVOLVING_CHILDREN",
  "GAMBLING",
  "NARCOTICS",
  "HUMAN_TRAFFICKING",
  "BURGLARY",
  "ASSAULT",
  "BATTERY"
)

normalized_index <- function(df, cols) {
  keep <- intersect(cols, names(df))
  m <- scale(df[keep]) 
  as.numeric(rowMeans(m))
}

bike$cbd_index <- normalized_index(bike, cbd_components)
bike$criminal_index <- normalized_index(bike, criminal_components)
```

**Central Business District Index**

The cbd_index measures how strongly each station area resembles a central business district. The variables chosen for the CBD grouping were bus and train stations, counts of retail food establishments and business licenses, the length of bike routes, and Divvy dock capacity. We expect that due to the nature of these variables there will be a positive relationship between CBD overall and trips on average, due to commuting needs and tourism.

**Criminal Index**

The criminal_index summarizes crimes that are most likely to deter Divvy ridership through safety or environmental concerns. For the crime variables, arson, weapons violation, homicide, motor vehcle theft, offense involving children, gambling, narcotics, human trafficking, burglary, assault, battery were chosen. These offenses tend to create a perception of danger and disorder within a neighborhood, which can discourage residents and visitors from using bike services. 

Initially, we tried to group the crimes by type of crime - i.e. personal harm vs. property damage, but the resulting model found that personal harm crimes were insignificant, which we did not deem to be realistic. Personal safety concerns are generally expected to influence travel behavior, so the lack of significance likely indicates that the classification by legal type did not accurately capture how people perceive safety risks and how those perceptions affect Divvy usage. This approach was interesting because it allowed us to test whether the formal legal categories of crime align with real-world behavioral responses. The results reveal that people's reactions to safety may not correspond neatly to how crimes are legally defined.

We then tried grouping by crime perception - i.e. crimes that make the news like homicide and assault versus those that don't such as intimidation. This also did not yield significant results, so we decided to group the crimes together and choose the specific crimes we thought would be a factor in affecting trips. The findings were interesting because we explored the psychological side of safety: whether media visibility or perceived severity of crime shapes travel behavior. The results suggest that everyday safety concerns that shape riders' sense of comfort might depend more on the general level of disorder in an area rather than the severity of individual incidents.

Finally, we tried grouping the criminal variables into those with positive versus negative impacts on bike demand, based on the correlation analysis. However, the VIF for the positive group was quite high, likely because crimes showing positive correlations with demand tend to occur in busy urban areas, which are the same places where Divvy ridership is concentrated, reflected by cbd_index. This was also an interesting finding because it highlights how apparent positive correlations in the correlation analysis could be misleading. What looks like a positive relationship between crime and demand may simply reflect the shared influence of urban density and activity levels rather than a true behavioral effect.

Hence, we decided to combine all selected relevant crimes into a single group rather than separating them by type or impact. This reduces multicollinearity with the cbd_index and better captures the overall effect of safety-related crimes on Divvy demand.

**Normalization**

To simplify the model and capture broader urban patterns, the crime and CBD variables were combined into composite indices. This helps summarize conceptually similar predictors that likely influence Divvy demand in the same direction. Before averaging, all variables were standardized using z-scored so that differences in scale would not distort the combined index. The index value is then the average of its standardized component scores.


# Correlation matrix & scatterplot

```{r}
vars <- c('trips', 'PARK_AREA_ACRES', 'PER_CAPITA_INCOME', 'POPULATION_SQ_MILE', 
          'MINORITY', 'EDU', 'cbd_index', 'criminal_index')
pairs.panels(bike[, vars], stars=T, density=T)
```

# Fit, residual plot, and VIFs

```{r}
fit = lm(trips ~ PARK_AREA_ACRES + POPULATION_SQ_MILE + MINORITY + EDU + cbd_index + criminal_index, data=bike)

summary(fit)
```

Since PER_CAPITA_INCOME shows a weak correlation with trip counts, it was excluded from the final model. The result of the model yields relationships between the predictor variables and trips. Park area, minority, and crimes have a negative relationship with trips. Population per square mile, education, and CBD have a positive relationship with trips. Of all of the variables, only the coefficient for population per square mile is not significant at the 5% level but at 10% level. The model achieves an R-squared of 0.7, meaning that approximately 70% of the variation in trip counts can be explained by the selected predictors. This suggests that the predictors of park area, demographics, education, urban centrality, and safety index generally capture key structural drivers of Divvy demand.

From the model, we can see that PARK_AREA_ACRES has a significant negative coefficient, meaning that areas with more park space tend to see fewer Divvy trips. This may seem counterintuitive but could imply that stations near large parks are less used for commuting and more for occasional leisure rides, which might lead to lower average trip counts.

Another interesting result generated from the model is that higher minority decreases the number of trips on average. This could highlight the societal links between race and socioeconomic status implicitly because one would not expect minority to directly affect the number of trips.

EDU shows a positive and significant effect, implying that areas with more educated populations are associated with higher Divvy usage. This could reflect a greater tendency to adopt alternative transportation options among more educated residents.

Finally, both cbd_index and criminal_index are highly significant, with cbd_index positively associated with trips and criminal_index negatively associated. These results are quite intuitive: proximity to business and transit hubs strongly increases demand, while higher crime levels reduce it. Together, they highlight how both accessibility and perceived safety play critical roles in shaping urban mobility patterns.


```{r}
vif(fit)
```

Notice that the VIFs for all predictors are quite low (close to 1), indicating that multicollinearity is not a concern and that the predictors are largely independent of one another.


```{r}
plot(fit, which=1)
```

The residual plot shows that the residuals are roughly centered around zero with no clear pattern, suggesting that the model's linearity assumption is reasonable. The spread of residuals appears fairly constant across fitted values, showing no major signs of heteroscedasticity.
